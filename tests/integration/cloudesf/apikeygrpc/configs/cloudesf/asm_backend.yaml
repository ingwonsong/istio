apiVersion: v1
kind: Service
metadata:
  name: cloud-esf-asm-codelab
spec:
  type: ClusterIP # Internal IP of the service
  selector:
    app: cloud-esf-asm-codelab
  ports:
  # Istio needs the prefix "grpc-" to set the protocol explicitly to grpc
  # https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#explicit-protocol-selection
  - name: grpc-8080
    port: 8080 # The port of the service
    targetPort: 26000 # The port of the backend.
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloud-esf-asm-codelab
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cloud-esf-asm-codelab
  template:
    metadata:
      labels:
        app: cloud-esf-asm-codelab
    spec:
      containers:
      - name: apikey-server
        image: gcr.io/cloudesf-testing/apikeys-server:stable
        ports:
        - containerPort: 26000
